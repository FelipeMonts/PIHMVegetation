AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
comppct_r, compname, localphase, slope_r, c.cokey
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
Q2
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r, comppct_r,
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
sandtotal_r, silttotal_r, claytotal_r, sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
sandtotal_r, silttotal_r, claytotal_r, sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
sandtotal_r, silttotal_r, claytotal_r, sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement)
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
sandtotal_r, silttotal_r, claytotal_r, sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement,
"JOIN chorizon ON component.cokey = chorizon.cokey")
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
sandtotal_r, silttotal_r, claytotal_r, sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement,
"LEFT OUTER JOIN component ON component.mukey = mapunit.mukey
LEFT OUTER JOIN chorizon ON ch.cokey = c.cokey")
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r,
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement,
"LEFT OUTER JOIN component ON component.mukey = mapunit.mukey
LEFT OUTER JOIN chorizon ON ch.cokey = c.cokey")
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement,
"LEFT OUTER JOIN component ON component.mukey = mapunit.mukey
LEFT OUTER JOIN chorizon ON ch.cokey = c.cokey")
q2
res2 <- SDA_query(q2)
q2<-paste0("SELECT
component.mukey, component.cokey, compname, comppct_r
FROM mapunit
LEFT JOIN component ON component.mukey = mapunit.mukey AND mukey IN ", in.statement,
" LEFT OUTER JOIN component ON component.mukey = mapunit.mukey
LEFT OUTER JOIN chorizon ON ch.cokey = c.cokey")
q2
res2 <- SDA_query(q2)
q <- paste("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res <- SDA_query(q)
head(res)
q <- paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
q2 <- paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
q2 <- paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
q2 <- paste0("SELECT
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ",
in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ",
in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, hzdept_r, hzdepb_r, hzname, awc_r, FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r, FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, co.key, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, c.cokey, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
.libPaths("C:/Felipe/Sotware&Coding/R_Library/library")  ;
co.sum.whc <- function(i) {
wt <- i$comppct_r[1] # keep the first component pct (they are all the same)
thick <- with(i, hzdepb_r - hzdept_r) # compute horizon thickness
whc <- thick * i$awc_r # compute water storage by horizon
whc.total <- sum(whc, na.rm=TRUE) # sum to get profile water storage
data.frame(whc=whc.total, wt=wt) # return profile water storage and component pct
}
mu.mean.whc <- function(i) {
whc <- wtd.mean(i$whc, weights=i$wt) # safely compute wt. mean water storage
data.frame(whc=whc) # return wt. mean water storage
}
library(Hmisc)
library(soilDB)
library(plyr)
library(raster)
library(aqp)
data(gSSURGO.chunk, package='soilDB')
gSSURGO.chunk <- ratify(gSSURGO.chunk, count=TRUE)
rat <- levels(gSSURGO.chunk)[[1]]
in.statement <- format_SQL_in_statement(rat$ID)
q <- paste("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res <- SDA_query(q)
head(res)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
co.whc <- ddply(res, c('mukey', 'cokey'), co.sum.whc)
mu.whc <- ddply(co.whc, 'mukey', mu.mean.whc)
head(mu.whc)
names(mu.whc)[1] <- 'ID'
rat.new <- join(rat, mu.whc, type='left')
levels(gSSURGO.chunk) <- rat.new
r.new <- deratify(gSSURGO.chunk, att='whc')
plot(r.new)
library(plyr)
library(raster)
library(foreign)
r <- raster('C:\\Felipe\\PIHM-CYCLES\\PIHM\\PIHM_Felipe\\CNS\\Manhantango\\gssurgo_g_pa\\GSSURGO_PA_TIFF\\MahatangoGSSG1.tif') ;
r <- ratify(r)
rat <- levels(r)[[1]]
rat
in.statement2 <- format_SQL_in_statement(rat$ID)
in.statement2
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
q3
res3 <- SDA_query(q3)
head(res2)
mu <- read.dbf('C:\\Felipe\\PIHM-CYCLES\\PIHM\\PIHM_Felipe\\CNS\\Manhantango\\gssurgo_g_pa\\GSSURGO_PA_TIFF\\MahatangoGSSG1.tif.vat.dbf') ;
names(mu)[1] <- 'ID'
library(Hmisc)
library(soilDB)
library(plyr)
library(raster)
library(aqp)
install.packages("soilDB", repos="http://R-Forge.R-project.org") # most recent copy from r-forge
install.packages("soilDB", repos = "http://R-Forge.R-project.org")
install.packages("foreign")
install.packages("foreign")
##### Working with the Package AQP #######
##### http://ncss-tech.github.io/AQP/soilDB/gSSURGO-SDA.html#####
#### Felipe Montes 2016 09 09 #############
#  Tell the program where the package libraries are  #####################
.libPaths("C:/Felipe/Sotware&Coding/R_Library/library")  ;
#### Install pakages #####
# function for computing profile-total water storage
co.sum.whc <- function(i) {
wt <- i$comppct_r[1] # keep the first component pct (they are all the same)
thick <- with(i, hzdepb_r - hzdept_r) # compute horizon thickness
whc <- thick * i$awc_r # compute water storage by horizon
whc.total <- sum(whc, na.rm=TRUE) # sum to get profile water storage
data.frame(whc=whc.total, wt=wt) # return profile water storage and component pct
}
# function for computing weighted-mean whc within a map unit
mu.mean.whc <- function(i) {
whc <- wtd.mean(i$whc, weights=i$wt) # safely compute wt. mean water storage
data.frame(whc=whc) # return wt. mean water storage
}
# load libraries
library(Hmisc)
library(soilDB)
library(plyr)
library(raster)
library(aqp)
data(gSSURGO.chunk, package='soilDB')
gSSURGO.chunk <- ratify(gSSURGO.chunk, count=TRUE)
rat <- levels(gSSURGO.chunk)[[1]]
in.statement <- format_SQL_in_statement(rat$ID)
q <- paste("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
res <- SDA_query(q)
head(res)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2)
co.whc <- ddply(res, c('mukey', 'cokey'), co.sum.whc)
mu.whc <- ddply(co.whc, 'mukey', mu.mean.whc)
head(mu.whc)
names(mu.whc)[1] <- 'ID'
rat.new <- join(rat, mu.whc, type='left')
levels(gSSURGO.chunk) <- rat.new
r.new <- deratify(gSSURGO.chunk, att='whc')
plot(r.new)
library(plyr)
library(raster)
library(foreign)
r <- raster('C:\\Felipe\\PIHM-CYCLES\\PIHM\\PIHM_Felipe\\CNS\\Manhantango\\gssurgo_g_pa\\GSSURGO_PA_TIFF\\MahatangoGSSG1.tif') ;
r <- ratify(r) ;
rat <- levels(r)[[1]] ;
in.statement2 <- format_SQL_in_statement(rat$ID)
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res3 <- SDA_query(q3)
head(res2)
install.packages('raster', dep=TRUE)
install.packages('plyr', dep=TRUE)
install.packages('Hmisc', dep=TRUE)
install.packages('soilDB', dep=TRUE) # stable version from CRAN + dependencies
install.packages("soilDB", repos="http://R-Forge.R-project.org") # most recent copy from r-forge
install.packages("SSOAP", repos = "http://www.omegahat.org/R", type="source") # SSOAP and XMLSchema
install.packages("foreign")
install.packages("httr", dep=TRUE)
install.packages("rgdal", dep = TRUE)
install.packages("raster", dep = TRUE)
install.packages("rgeos", dep = TRUE)
install.packages("raster", dep = TRUE)
install.packages("plyr", dep = TRUE)
install.packages("soilDB", dep = TRUE)
install.packages("soilDB", repos = "http://R-Forge.R-project.org")
install.packages("Hmisc", dep = TRUE)
install.packages("httr", dep = TRUE)
install.packages("rgdal", dep = TRUE)
install.packages("raster", dep = TRUE)
install.packages("soilDB", dep = TRUE)
install.packages("Hmisc", dep = TRUE)
install.packages("rgdal", dep = TRUE)
install.packages("raster", dep = TRUE)
install.packages("soilDB", repos = "http://R-Forge.R-project.org")
install.packages("httr", dep = TRUE)
install.packages("raster", dep = TRUE)
install.packages("soilDB", repos = "http://R-Forge.R-project.org")
install.packages("rgdal", dep = TRUE)
install.packages("httr", dep = TRUE)
install.packages("rgdal", dep = TRUE)
install.packages("httr", dep = TRUE)
##### Working with the Package AQP #######
##### http://ncss-tech.github.io/AQP/soilDB/gSSURGO-SDA.html#####
#### Felipe Montes 2016 09 09 #############
#  Tell the program where the package libraries are  #####################
.libPaths("C:/Felipe/Sotware&Coding/R_Library/library")  ;
# function for computing profile-total water storage
co.sum.whc <- function(i) {
wt <- i$comppct_r[1] # keep the first component pct (they are all the same)
thick <- with(i, hzdepb_r - hzdept_r) # compute horizon thickness
whc <- thick * i$awc_r # compute water storage by horizon
whc.total <- sum(whc, na.rm=TRUE) # sum to get profile water storage
data.frame(whc=whc.total, wt=wt) # return profile water storage and component pct
}
# function for computing weighted-mean whc within a map unit
mu.mean.whc <- function(i) {
whc <- wtd.mean(i$whc, weights=i$wt) # safely compute wt. mean water storage
data.frame(whc=whc) # return wt. mean water storage
}
# load libraries
library(Hmisc)
library(soilDB)
library(plyr)
library(raster)
library(aqp)
library(sp)
library(rgdal)
library(raster)
library(rgeos)
library(lattice)
library(MASS)
# load chunk of gSSURGO
data(gSSURGO.chunk, package='soilDB')
# convert into a raster + RAT
gSSURGO.chunk <- ratify(gSSURGO.chunk, count=TRUE)
# save RAT to new object, will use later
rat <- levels(gSSURGO.chunk)[[1]]
# extract the map unit keys from the RAT, and format for use in an SQL IN-statement
in.statement <- format_SQL_in_statement(rat$ID)
# format query in SQL- raw data are returned
q <- paste("SELECT component.mukey, component.cokey, compname, comppct_r, hzdept_r, hzdepb_r, hzname, awc_r
FROM component JOIN chorizon ON component.cokey = chorizon.cokey
AND mukey IN ", in.statement, "ORDER BY mukey, comppct_r DESC, hzdept_r ASC", sep="")
# now get component and horizon-level data for these map unit keys
res <- SDA_query(q)
head(res)
q2 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res2 <- SDA_query(q2)
head(res2,20)
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r, om_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
in.statement2 <- format_SQL_in_statement(rat$ID)
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r, om_r FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res3 <- SDA_query(q3);
head(res2) ;
res3$id<-res3$mukey ;
res3$top<-res3$hzdept_r ;
res3$bottom<-res3$hzdepb_r ;
res3$name<-res3$hzname ;
depths(res3)<-id ~ top + bottom  ;
str(res3) ;
plot(res3, name='name')
plot(res3, name='name', color='om_r')
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r, om_r,dbtenthbar_r, dbthirdbar_r, dbfifteenbar_r  FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res3 <- SDA_query(q3);
head(res2) ;
res3$id<-res3$mukey ;
res3$top<-res3$hzdept_r ;
res3$bottom<-res3$hzdepb_r ;
res3$name<-res3$hzname ;
depths(res3)<-id ~ top + bottom  ;
str(res3) ;
plot(res3, name='name', color='dbtenthbar_r')
plot(res3, name='name', color='claytotal_r')
head(res3) ;
plot(res3, name='name', color='dbthirdbar_r')
plot(res3[1:10], name='name', color='dbthirdbar_r')
res3[1]
res3[1:3]
print(res3[1])
print(res3[1:3])
head[res3]
plot(res3[1:3], name='name', color='dbthirdbar_r')
q3 <- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r, om_r,dbtenthbar_r, dbthirdbar_r, dbfifteenbar_r, fraggt10_r, frag3to10_r, sieveno10_r, sieveno40_r, sieveno200_r  FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
res3 <- SDA_query(q3);
head(res3) ;
res3$id<-res3$mukey ;
res3$top<-res3$hzdept_r ;
res3$bottom<-res3$hzdepb_r ;
res3$name<-res3$hzname ;
depths(res3)<-id ~ top + bottom  ;
str(res3) ;
plot(res3[1:10], name='name', color='dbthirdbar_r')
plot(res3[1:10], name='name', color='frag3to10_r')
install.packages("dplyr")
.libPaths("C:/Felipe/Sotware&Coding/R_Library/library")  ;
install.packages("dplyr")
# load libraries
library(Hmisc) ;
library(soilDB) ;
library(plyr) ;
library(raster) ;
library(aqp) ;
library(sp) ;
library(rgdal) ;
library(raster) ;
library(rgeos) ;
library(lattice) ;
library(MASS) ;
library(RColorBrewer) ;
library(ggplot2)  ;
#library(tmap) ;
library(dplyr)  ;
library(tidyr)  ;
library(devtools) ;
sessionInfo()
########################## import the raster file with the GSSURGO Data for the watershed in PIHM ####################
Manhatango_GSSURGO<- raster('C:\\Felipe\\PIHM-CYCLES\\PIHM\\PIHM_Felipe\\CNS\\Manhantango\\gssurgo_g_pa\\GSSURGO_PA_TIFF\\MahatangoGSSG1.tif') ;
# generate a RAT via raster package functionality
Manhatango_GSSURGO <- ratify(Manhatango_GSSURGO) ;
# extract RAT to a data.frame
MUKEYS <- levels(Manhatango_GSSURGO)[[1]] ;
################################ Query the Soil Data access database with SQL through R #################
# from https://sdmdataaccess.sc.egov.usda.gov/queryhelp.aspx
# and https://sdmdataaccess.sc.egov.usda.gov/documents/ReturningSoilTextureRelatedAttributes.pdf
# --Sample query begins.
# --Note that a pair of dashes denotes the beginning of a comment.
# SELECT
# saversion, saverest, -- attributes from table "sacatalog"
# l.areasymbol, l.areaname, l.lkey, -- attributes from table "legend"
# musym, muname, museq, mu.mukey, -- attributes from table "mapunit"
# comppct_r, compname, localphase, slope_r, c.cokey, -- attributes from table "component"
# hzdept_r, hzdepb_r, ch.chkey, -- attributes from table "chorizon"
# sandtotal_r, silttotal_r, claytotal_r, --total sand, silt and clay fractions from table "chorizon"
# sandvc_r, sandco_r, sandmed_r, sandfine_r, sandvf_r,--sand sub-fractions from table "chorizon"
# texdesc, texture, stratextsflag, chtgrp.rvindicator, -- attributes from table "chtexturegrp"
# texcl, lieutex, -- attributes from table "chtexture"
# texmod -- attributes from table "chtexturemod"
# FROM sacatalog sac
# INNER JOIN legend l ON l.areasymbol = sac.areasymbol AND l.areatypename = 'Non-MLRA Soil Survey Area'
# INNER JOIN mapunit mu ON mu.lkey = l.lkey
# AND mu.mukey IN
# ('107559','107646','107674','107682','107707','107794','107853','107854','107865','107867','107869','107870','107871')
# LEFT OUTER JOIN component c ON c.mukey = mu.mukey
# LEFT OUTER JOIN chorizon ch ON ch.cokey = c.cokey
# LEFT OUTER JOIN chtexturegrp chtgrp ON chtgrp.chkey = ch.chkey
# LEFT OUTER JOIN chtexture cht ON cht.chtgkey = chtgrp.chtgkey
# LEFT OUTER JOIN chtexturemod chtmod ON chtmod.chtkey = cht.chtkey
# --WHERE.
# --ORDER BY l.areaname, museq, comppct_r DESC, compname, hzdept_r -- standard soil report ordering
# --Sample query ends.
# extract the map unit keys from the RAT, and format for use in an SQL IN-statement
in.statement2 <- format_SQL_in_statement(MUKEYS$ID)
# format query in SQL- raw data are returned
Pedon.query<- paste0("SELECT component.mukey, component.cokey, compname, comppct_r, majcompflag, slope_r, hzdept_r, hzdepb_r,hzthk_r, hzname, awc_r, sandtotal_r, silttotal_r, claytotal_r, om_r,dbtenthbar_r, dbthirdbar_r, dbfifteenbar_r, fraggt10_r, frag3to10_r, sieveno10_r, sieveno40_r, sieveno200_r, ksat_r  FROM component JOIN chorizon ON component.cokey = chorizon.cokey AND mukey IN ", in.statement2," ORDER BY mukey, comppct_r DESC, hzdept_r ASC") ;
# now get component and horizon-level data for these map unit keys
Pedon.info<- SDA_query(Pedon.query);
head(Pedon.info) ;
# filter components that are the major components of each unit map with the Flag majcompflag=='Yes'
Pedon.info.MajorC<-Pedon.info[which(Pedon.info$majcompflag == 'Yes'),]  ;
head(Pedon.info.MajorC) ;
# check if there are mukeys with more than one dominant component
Pedon.info.MajorC$mukey.factor<-as.factor(Pedon.info.MajorC$mukey) ;
Pedon.info.MajorC$cokey.factor<-as.factor(Pedon.info.MajorC$cokey) ;
Pedon.info.MajorC$mukey_comppct_r<-paste(Pedon.info.MajorC$mukey.factor,Pedon.info.MajorC$comppct_r, sep = "_") ;
# Select major component mukeys that have also the highest component percent comppct_r
head(Pedon.info.MajorC)
Dominant<- aggregate(comppct_r ~ mukey.factor, data=Pedon.info.MajorC, FUN="max" , drop=T, simplify=T) ;
head(Dominant)
Dominant$mukey_comppct_r<-paste(Dominant$mukey.factor,Dominant$comppct_r, sep ="_");
Mukey.Pedon<-Pedon.info.MajorC[Pedon.info.MajorC$mukey_comppct_r %in% Dominant$mukey_comppct_r,]
data(sp4)
depths(sp4) <- id ~ top + bottom
slice(sp4, fm= 0:15 ~ sand + silt + clay + name + ex_Ca_to_Mg)
sessionInfo()
install.packages("aqp")
install.packages("aqp")
install.packages("aqp")
#  Tell the program where the package libraries are  #####################
.libPaths("C:/Felipe/Sotware&Coding/R_Library/library")  ;
#  Set Working directory
setwd("C:/Felipe/PIHM-CYCLES/PIHM/PIHM_R_Scripts/PIHMVegetation") ;
########### Install packages  #####################
# install.packages('raster', dep=TRUE)
NumRiv<-read.table('C:/Felipe/PIHM-CYCLES/PIHM/PIHM_Felipe/CNS/Manhantango/HydroTerreFullManhantango/HansYostDeepCreek/Aug2920171550/4DataModelLoader/MergeVectorLayer000_q30_a200000.riv',as.is=T,nrows=1)[1,1];
NumRiv
River.file<-'C:/Felipe/PIHM-CYCLES/PIHM/PIHM_Felipe/CNS/Manhantango/HydroTerreFullManhantango/HansYostDeepCreek/Aug2920171550/4DataModelLoader/MergeVectorLayer000_q30_a200000.att'
River.file
NumRiv<-read.table(River.file,as.is=T,nrows=1)[1,1];
riv.elements<-read.table(River.file,as.is=T,skip=1,nrows=NumRiv,col.names=c('Index', 'FromNode', 'ToNode', 'Down', 'LeftEle', 'RightEle', 'Shape', 'Material', 'IC', 'BC', 'Res'));
shape<-read.table(River.file,as.is=T,skip=1+NumRiv,nrows=1);
NumShape<-shape[1,2];
riv.shape<-read.table(River.file,as.is=T,skip=1+NumRiv+1,nrows=NumShape,col.names=c('Index', 'Depth', 'InterpOrd', 'WidCoeff'));
shape<-read.table(River.file,as.is=T,skip=1+NumRiv,nrows=1);
NumShape<-shape[1,2];
shape[1,2]
shape
View(shape)
View(shape)
rm(shape)
read.table(River.file,as.is=T,skip=1+NumRiv,nrows=1)
River.file<-'C:/Felipe/PIHM-CYCLES/PIHM/PIHM_Felipe/CNS/Manhantango/HydroTerreFullManhantango/HansYostDeepCreek/Aug2920171550/4DataModelLoader/MergeVectorLayer000_q30_a200000.att'
NumRiv<-read.table(River.file,as.is=T,nrows=1)[1,1];
NumRiv
NumRiv<-read.table(River.file,as.is=T,nrows=1)[1,1];
NumRiv
River.file<-'C:/Felipe/PIHM-CYCLES/PIHM/PIHM_Felipe/CNS/Manhantango/HydroTerreFullManhantango/HansYostDeepCreek/Aug2920171550/4DataModelLoader/MergeVectorLayer000_q30_a200000.riv'
NumRiv<-read.table(River.file,as.is=T,nrows=1)[1,1];
NumRiv
riv.elements<-read.table(River.file,as.is=T,skip=1,nrows=NumRiv,col.names=c('Index', 'FromNode', 'ToNode', 'Down', 'LeftEle', 'RightEle', 'Shape', 'Material', 'IC', 'BC', 'Res'));
shape<-read.table(River.file,as.is=T,skip=1+NumRiv,nrows=1);
shape
NumShape<-shape[1,2];
riv.shape<-read.table(River.file, as.is=T,skip=1+NumRiv+1,nrows=NumShape,col.names=c('Index', 'Depth', 'InterpOrd', 'WidCoeff'));
riv.shape
Material<-read.table(River.file),as.is=T,skip=1+NumRiv+1+NumShape,nrows=1);
Material<-read.table(River.file,as.is=T,skip=1+NumRiv+1+NumShape,nrows=1);
NumMat<-Material[1,2];
NumMat
riv.material<-read.table(River.file,as.is=T,skip=1+NumRiv+1+NumShape+1,nrows=NumMat,col.names=c('Index', 'n', 'Cwr', 'KsatH','KsatV','Bed'));
IC<-read.table(River.file,as.is=T,skip=1+NumRiv+1+NumShape+1+NumMat,nrows=1);
NumIC<-IC[1,2];
NumIC
riv.IC<-read.table(River.file,as.is=T,skip=NumRiv+1+NumShape+1+1+NumMat+1,nrows=NumIC,col.names=c('Index', 'Value'));
BC<-read.table(River.file,as.is=T,skip=1+NumRiv+1+NumShape+1+NumMat+1+NumIC,nrows=1);
NumBC<-BC[1,2];
Res<-read.table(River.file,as.is=T,skip=1+NumRiv+1+NumShape+1+NumMat+1+NumIC+max(c(NumBC,1)),nrows=1);
Res
